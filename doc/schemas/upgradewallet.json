{
  "$schema": "../rpc-schema-draft.json",
  "type": "object",
  "rpc": "upgradewallet",
  "title": "Command to spend all P2SH-wrapped inputs into a Native Segwit output",
  "description": [
    "`upgradewallet` is a convenience RPC which will spend all p2sh-wrapped Segwit deposits in a wallet into a single Native Segwit P2WPKH address."
  ],
  "request": {
    "required": [],
    "additionalProperties": false,
    "properties": {
      "feerate": {
        "type": "feerate",
        "description": [
          "Feerate for the upgrade transaction."
        ],
        "added": "v23.02",
        "default": "*opening*"
      },
      "reservedok": {
        "type": "boolean",
        "description": [
          "Tells the wallet to include all P2SH-wrapped inputs, including reserved ones."
        ],
        "added": "v23.02"
      }
    }
  },
  "response": {
    "required": [
      "upgraded_outs"
    ],
    "additionalProperties": false,
    "properties": {
      "upgraded_outs": {
        "type": "u64",
        "description": [
          "Count of spent/upgraded UTXOs."
        ],
        "added": "v23.02"
      },
      "psbt": {
        "type": "string",
        "description": [
          "The PSBT that was finalized and sent."
        ],
        "added": "v23.02"
      },
      "tx": {
        "type": "hex",
        "description": [
          "The raw transaction which was sent."
        ],
        "added": "v23.02"
      },
      "txid": {
        "type": "txid",
        "description": [
          "The txid of the **tx**."
        ],
        "added": "v23.02"
      }
    }
  },
  "usage": [
    "The caller is trying to buy a liquidity ad but the command keeps failing. They have funds in their wallet, but they're all P2SH-wrapped outputs.",
    "",
    "The caller can call `upgradewallet` to convert their funds to native segwit outputs, which are valid for liquidity ad buys."
  ],
  "author": [
    "Lisa Neigut <<niftynei@gmail.com>> is mainly responsible."
  ],
  "see_also": [
    "lightning-utxopsbt(7)",
    "lightning-reserveinputs(7)",
    "lightning-unreserveinputs(7)"
  ],
  "resources": [
    "Main web site: <https://github.com/ElementsProject/lightning>"
  ],
  "examples": [
    {
      "request": {
        "id": "example:upgradewallet#1",
        "method": "upgradewallet",
        "params": {}
      },
      "response": {
        "upgraded_outs": 0
      }
    },
    {
      "request": {
        "id": "example:upgradewallet#2",
        "method": "upgradewallet",
        "params": {
          "feerate": "urgent",
          "reservedok": true
        }
      },
      "response": {
        "tx": "0200000001f74032b51c3aeec264de1e41228db610127098f70d31e28d91569b13a2eda1090100000000fdffffff0135143101000000002251206c27e1956acfa61e68292c80908880e813450f754132e8a2ac471a86bf1326b567000000",
        "txid": "58d7e19cd533038fefb7085822fa42f78fac7b7bbdad5439cc748eb2a37f53cb",
        "psbt": "cHNidP8BAgQCAAAAAQMEZwAAAAEEAQEBBQEBAQYBAwH7BAIAAAAAAQBzAgAAAAGnLEWbriFxVrxyaD9GGIXPwYs7lkx3nIQmKKzZx1ONvAAAAAAA/f///wJxxNQoAQAAABepFIIMEhvBkPKuK79E5Hw+MqTQP5ubhwAtMQEAAAAAF6kUZVco82z+NtAapQ0yNnBEafhKVUCHZgAAAAEBIAAtMQEAAAAAF6kUZVco82z+NtAapQ0yNnBEafhKVUCHIgICucDGhE4SpTHJaOVcVQeOwW2b92vpKQ/YfRzKcrSDmhdHMEQCIHUzolkCb3kn5oFBsprLwfRU0r2TMuUqVlKHAVeEzwZhAiAJoUyO3JIEy76Le2UdvCjNd5uQ4VO2pTSJC0kv8CHfTAEBBBYAFNa5adNt/9rZhpGT9mPuSA39xzSIIgYCucDGhE4SpTHJaOVcVQeOwW2b92vpKQ/YfRzKcrSDmhcI1rlp0wAAAAABDiD3QDK1HDruwmTeHkEijbYQEnCY9w0x4o2RVpsTou2hCQEPBAEAAAABEAT9////AAEDCDUUMQEAAAAAAQQiUSBsJ+GVas+mHmgpLICQiIDoE0UPdUEy6KKsRxqGvxMmtSEHWnm7u0BtS8KN8F+mqHMoz7AqfhN0O+zc0d/P4HHC4BAJAH0I2ZcFAAAAAA==",
        "upgraded_outs": 1
      }
    }
  ]
}
