{
  "$schema": "../rpc-schema-draft.json",
  "type": "object",
  "rpc": "createonion",
  "title": "Low-level command to create a custom onion",
  "description": [
    "The **createonion** RPC command allows the caller to create a custom onion with custom payloads at each hop in the route. A custom onion can be used to implement protocol extensions that are not supported by Core Lightning directly."
  ],
  "request": {
    "required": [
      "hops",
      "assocdata"
    ],
    "additionalProperties": false,
    "properties": {
      "hops": {
        "type": "array",
        "description": [
          "A JSON list of dicts, each specifying a node and the payload destined for that node."
        ],
        "items": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "pubkey",
            "payload"
          ],
          "properties": {
            "pubkey": {
              "type": "pubkey",
              "description": [
                "Node pubkey."
              ]
            },
            "payload": {
              "type": "hex",
              "description": [
                "Payload to be sent to the node."
              ]
            }
          }
        }
      },
      "assocdata": {
        "type": "hex",
        "description": [
          "The associated data that the onion should commit to. If the onion is to be used to send a payment later it MUST match the `payment_hash` of the payment in order to be valid."
        ]
      },
      "session_key": {
        "type": "secret",
        "description": [
          "Can be used to specify a secret that is used to generate the shared secrets used to encrypt the onion for each hop. It should only be used for testing or if a specific shared secret is important. If not specified it will be securely generated internally, and the shared secrets will be returned."
        ]
      },
      "onion_size": {
        "type": "u16",
        "description": [
          "A size different from the default payment onion (1300 bytes). May be used for custom protocols like trampoline routing."
        ]
      }
    }
  },
  "response": {
    "required": [
      "onion",
      "shared_secrets"
    ],
    "additionalProperties": false,
    "properties": {
      "onion": {
        "type": "hex",
        "description": [
          "The onion packet (*onion_size* bytes)."
        ]
      },
      "shared_secrets": {
        "type": "array",
        "description": [
          "One shared secret for each node in the *hops* parameter."
        ],
        "items": {
          "type": "secret",
          "description": [
            "The shared secret with this hop."
          ]
        }
      }
    }
  },
  "author": [
    "Christian Decker <<decker.christian@gmail.com>> is mainly responsible."
  ],
  "see_also": [
    "lightning-sendonion(7)",
    "lightning-getroute(7)"
  ],
  "resources": [
    "Main web site: <https://github.com/ElementsProject/lightning>",
    "",
    "[BOLT 04](https://github.com/lightning/bolts/blob/master/04-onion-routing.md)"
  ],
  "examples": [
    {
      "request": {
        "id": "example:createonion#1",
        "method": "createonion",
        "params": {
          "hops": [
            {
              "pubkey": "022d223620a359a47ff7f7ac447c85c46c923da53389221a0054c11c1e3ca31d59",
              "payload": "11020203e804019106080000700000010000"
            },
            {
              "pubkey": "035d2b1192dfba134e10e540875d366ebc8bc353d5aa766b80c090b39c3a5d885d",
              "payload": "11020203e804019106080000720000010000"
            },
            {
              "pubkey": "0382ce59ebf18be7d84677c2e35f23294b9992ceca95491fcf8a56c6cb2d9de199",
              "payload": "2b020203e804018b0822d1d843a07ff04801a9c926cfef8fbd242a35d332fde5e255e6b4c92e2fc5030f03e8"
            }
          ],
          "assocdata": "47c148c1746366e4c2c7496621c22002bc2711b4d9c52cbb9c7b1fdca59c8579"
        }
      },
      "response": {
        "onion": "00021d5b7e75f56e8fb8c5dbbcfdf954b89d171b35fced6bf4ad929b3b6e081e16c93046493f6f0f4e6f983b424e799b9f60ae7c75fa260760393aad7958e04ec5ea5a06e11078daa9ff31a1aaeed8b04f5ce319118a4bdda9e90861829161dd4d44164816f566d0cc219da32fdd08249068cec2fd589fb216933b95adce045364fcb6d6905a4e4169346b75e6ccfecb0cfdfd74d0574eb684b952db7df8443541cc28296f42afeafbb7a34c3f8c64dce9c0ebb37f5485f66246cbf11b7a8cd4a45d64723b7e706b1ef3eff4ce6133aa86f6c044337716bd0c1173b92b13c4d11453ab850fd945c1af91d3ce41928600bbafbc81b56e3bc704a678a783e2232bc80bc4afa93f84498127123096af80ca5295bb02b6c6524720a0f4dc81075688632b9428f6f4399a0ecf6c17e5c3015c9715af5127000787cc8d7e023f96b6e0175d600911c1dffef6a0d2a8ea8059b287e9e941810de5190ce0c274d6452a8ecc06a0cb98a9550e7e80e8eebdb9c326ca2a3f25b3147daaa68b8d5f745344938645535f858f6a4484b17322b4076714994865ac1660c4f364309bb5147c55bf8458cf6aa7420896d2cb1ee0fe301c83109a102a42d41063c32732ef0366b9b9bd7516c3f7607a54eb3255fa6589bd3ea021cb9deee71b3ea33fa9e509c085216243ea6cea4acf038fee2a4e7418f4087c79423f8bc94fda1ea7de66cb06c131304e39b20634e70721f028427093e059065e6d157cbbdb1ea02476478033164cc90b7707c612897224099c8f3cae86cf0503a1fc1c21e86f4fa7c6332786cc0c44b379516032a93d1c4853453b819d30438814b28bbb14989dfb88819e3fd9b38267b84cc052637ca9c5ae2b149fb53831e4237036cde4b6dd0c0754c52551585692beba1b4228540255ad6fd6bd7912acd47816023332a52075db994decac8cc3611a0f222638084b71a3f8f4c019af28524d96a609fd7cf2e660414b8db54a2d77087087313dea24cab947c04a3ca191d3ba8ffd5ddef72fbc6ad1fc7c71e97cc3da1b677108b907c591c32cb3a41b5636292d9db891013c2d729d67162e4388bee98469f98871af9b5580768f0db885106b981274060f1b3bca8f7297287c6688f6c30054f727d7dd9baa097175fb198b3477c2f1545ea6425f0a6df732ea4be943dff9cece87a9751be426669b1f8b3cb3f7a39f2b72ee68c287e6db1c86405b782c774c22acad3a68bb377713958f6c89e7b8a3d17e52416ea9bdb959949b47af8dd6b380ebc0481873de65edf599f3c1f51c9e4abd388e4d6ad6cf48e5c279286ed7bc683523b9c016227af1cdcf856ec11b47d3f369ac4fde6cee8e19748ef6c365c5effdc81afe560e1597891256dad1b849f550ab681b0c8ba660f1172ac3f63069140c2180537d793f899ba897dae47a848b6e4b1ceac369c59257a3c1d4f2cefe0b64e84ac010397bc55d77a8f801b227ab6453770fc9775788c4a9ce7bdc5f40aa156d1b0c4f9ef41dfbb0518151809761d22e503b9b8725704bbe4f7aaaf4188f80106354743e3f605a1cee1d6d09226176a913a3f9fe9513a081377c820e582fffd534cb27146264972b9f5362dc37cacb821e64ef711eb39addbe1a747df2b1cc54f26dfc1a32ac26297b980e4a492e2242d6d745e508e65f6162ba6e28d4f1f2177c5896c9d82019a74cd6f136e04af3a01a2178e961c0d4e63235982807579ea34f306ec0ea3f0e58a8fee4dd28c2303fa9e09e45b8c9cbc6a69aba0b838473a33e2a287f0824936bfd427f72b7bb7362a40f77136ecfe53173b2acfbbdd49ec390078926d0a9a69114312fee5a9b5ad8f7b80711f76d5ffca8632593b2ea9b2caaebf219ec7586e9d6962353f98b2882fb804a34b16946453038127de73f4e827b190f6001b7a5560b7eb978f8",
        "shared_secrets": [
          "f0652f245faf69100228c62e03a064bdbc7e3ac191e1c5bb094a94c1939d8b9b",
          "b252680750e43ce4fdb2bc38c9b31f6b9b37d5d1bd9abf679dfcc33047154180",
          "760e4382462d61429cf7ba5af877aa82516119dfc3d7172350234b5018f87626"
        ]
      }
    },
    {
      "request": {
        "id": "example:createonion#2",
        "method": "createonion",
        "params": {
          "hops": [
            {
              "pubkey": "022d223620a359a47ff7f7ac447c85c46c923da53389221a0054c11c1e3ca31d59",
              "payload": "11020203e804019106080000700000010000"
            },
            {
              "pubkey": "035d2b1192dfba134e10e540875d366ebc8bc353d5aa766b80c090b39c3a5d885d",
              "payload": "11020203e804019106080000720000010000"
            },
            {
              "pubkey": "0382ce59ebf18be7d84677c2e35f23294b9992ceca95491fcf8a56c6cb2d9de199",
              "payload": "2b020203e804018b0822d1d843a07ff04801a9c926cfef8fbd242a35d332fde5e255e6b4c92e2fc5030f03e8"
            }
          ],
          "assocdata": "47c148c1746366e4c2c7496621c22002bc2711b4d9c52cbb9c7b1fdca59c8579",
          "session_key": "4141414141414141414141414141414141414141414141414141414141414141"
        }
      },
      "response": {
        "onion": "0002eec7245d6b7d2ccb30380bfbe2a3648cd7a942653f5aa340edcea1f2836866191c78fd992adb6335814526c8f53ab57e22cd57b69c19115ac040a9b54cfee007a2aed47573c7939d15b1411605e9e0f03698d38499e802a15853122723857dbddb629cf2e16a1292a1c951ca4211efadc17b6e219e5dacfe19ee6288cc29ddd440c056ed1ea9fa2c0caea86d7b0de9338326e4f13bb1cda872a64a836a729350f2e79c3ac8618ddfacbd70d588759e8701901d74b64bf51f1c21cdc785b54dc5a6ba39fc75f956b60a372f6421a84f6001b294487baf1bb049b7bd901c5854c0999a82095874b02da90021a685f7c77f4b724a3d27489c091807b32bcdfb2c68f69b50c0b43c78288c333dbb007874f36fcf224fbc2ed89690f64a62b5ecfe6275750eb1a5575f689ca6d59c9a570689372db120cf6a29177caaace5ac671a3607d37a3048af18d1d736ac8a4dde8efc4884f8eab23cdc8cb15170471ee7b416b5cf089dee8ab8ac3eea6700a6040839c1e86f6d2b5acf9c7bac856cae96e9d1b7142f91ac4818cf0007a23100ae621470ac2552116f30948f21602237d12d29f58ca73f10f05b38f7b4b728fcfd8aafc1a82502aae3081c4bc8a77771aef16247bcf26d8569140441c405a3c21a649a8439797f45e7c37a2025318f4c88e3eba454fd4cc37e9978b59fa7b1e41af450523713fdad8070c7abdeea299474c99b2bde737e8c8ad79cb9fdd70a935ad29504d185bf100a339d203cd929030454a6450132255fea11ba0c6a520fa7cc3b8638f8032a61c492f7f9d1ec591a851f25df9238945ae467126b64019f21a71a2d3ef46cdd7b61773ad632dc77e0bda7d06b493efe940d9b975ebb85c423a83d24966f5e2ae2ec9c3b2257cc21a4989dd016d688865ba5245667c302e408dc56ffdf4282ad834f0c5af1ce49b3997fe397faf6874cac24ae346b4e72e468506c0e724efe6f805e0fd115de39b6fa29d05e11bbe2ec27548517f93ebd7b977b13237ab9c40ff5766f7263ea1f2eabba460600cd7da082fcf8d0a7bd37054abfd6040f886dde48cf600612b5b73a44026e79d46336de73f2ea5fbfc9603ccd89f6954e5093b6bfe556e6f67deb0878128049186f7ac6ef461a56c2bb4f24a9679fb386e06052c3da2f367f14bc41ec191f5b0b7b3ccad1f2cc58c863c49055c889b8b04b6b6cbaec50d0d103d4ea0da75952a730b07cea0da43914b5ab3f30b5104d9a75eb003da0b5b97bf9eb9081194cc5b50362041a972841bdafde31909929237ed5b94c88dd05126cdb3fd25add0c777c2ad021e1a0e7140d6c4c2005cb353a7a6a747ee75467c052f55faa485cbcf3758eafba7a8ef00d1481cc0f05af539116f443cb02a7b30a3de899dc66cb0781ccccf5c8d93b34be0665d11cbca55cd7a424b958124edf1289c7f4fc19c1be8fc7a861ce47c43a641bafdb195e1c74a1fbf69dbd518013f3dbf2860818b5a3e6f1dd36a5546bfd416e9714dec29818ecd1aeeb29c319b407c497621248d232680417486698a3e1262f03a8bc6441d1de40ae351dae4527a8efe25fc68a3f1571aa556edd6bfb9db7caba4d2c02bab003c43055f5d3ebf961735c3b1f4cd3e0a96038697a95cceac08c0aff084450cf571f81c95d468826aa4292997ccfeba32db77c4c22a9d3caa0a37a8a961ac2f2c8a6965687143bc93c620503839fd7bd7fc2e6d9c966586b713f824b8e9d3de55cb1b81f9204b92dfaa066920c0910e62e59650e904e05b94bde3e467d45719d6a3b85a71c8ff1dcca5a5f497928db5f64c55aad93513e87f4f0c93a6fa5a9afe929cf8223ea509f584913844044aa23a4afa4bc0ad975f4904aab5d77b5e51511460a3b7a3bfa335d623f0f5949b72174681526f075633af9234092fd1f7a5c6767292ef5",
        "shared_secrets": [
          "2d7581974cde41b42da1d0a3147704aae5a71e8987fa30dc920c8cdf784b661d",
          "bb599b824ce9e123c8cb27cd50a996e5035b8ae903356dcbff224496aab3a891",
          "7bc4f97c2d18d5372ef572334e31590ec36b33220d7a71fa4e0fe841174eaccb"
        ]
      }
    }
  ]
}
