{
  "$schema": "../rpc-schema-draft.json",
  "type": "object",
  "rpc": "listhtlcs",
  "title": "Command for querying HTLCs",
  "description": [
    "The **listhtlcs** RPC command gets all HTLCs (which, generally, we remember for as long as a channel is open, even if they've completed long ago)."
  ],
  "categories": [
    "readonly"
  ],
  "request": {
    "required": [],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "string",
        "description": [
          "A short channel id (e.g. 1x2x3) or full 64-byte hex channel id, it will only list htlcs for that channel (which must be known)."
        ]
      },
      "index": {
        "type": "string",
        "added": "v25.05",
        "enum": [
          "created",
          "updated"
        ],
        "description": [
          "This controls the ordering of results."
        ],
        "default": "`created`"
      },
      "start": {
        "type": "u64",
        "added": "v25.05",
        "description": [
          "If `index` is specified, `start` may be specified to start from that value, which is generally returned from lightning-wait(7)."
        ]
      },
      "limit": {
        "type": "u32",
        "added": "v25.05",
        "description": [
          "If `index` is specified, `limit` can be used to specify the maximum number of entries to return."
        ]
      }
    }
  },
  "response": {
    "required": [
      "htlcs"
    ],
    "additionalProperties": false,
    "properties": {
      "htlcs": {
        "type": "array",
        "items": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "created_index",
            "short_channel_id",
            "id",
            "expiry",
            "direction",
            "amount_msat",
            "payment_hash",
            "state"
          ],
          "properties": {
            "short_channel_id": {
              "type": "short_channel_id",
              "description": [
                "The channel that contains/contained the HTLC."
              ]
            },
            "created_index": {
              "added": "v25.05",
              "type": "u64",
              "description": [
                "1-based index indicating order this htlc was created in."
              ]
            },
            "updated_index": {
              "added": "v25.05",
              "type": "u64",
              "description": [
                "1-based index indicating order this htlc was changed (only present if it has changed since creation)."
              ]
            },
            "id": {
              "type": "u64",
              "description": [
                "The unique, incrementing HTLC id the creator gave this."
              ]
            },
            "expiry": {
              "type": "u32",
              "description": [
                "The block number where this HTLC expires/expired."
              ]
            },
            "amount_msat": {
              "type": "msat",
              "description": [
                "The value of the HTLC."
              ]
            },
            "direction": {
              "type": "string",
              "enum": [
                "out",
                "in"
              ],
              "description": [
                "Out if we offered this to the peer, in if they offered it."
              ]
            },
            "payment_hash": {
              "type": "hash",
              "description": [
                "Payment hash sought by HTLC."
              ]
            },
            "state": {
              "type": "string",
              "enum": [
                "SENT_ADD_HTLC",
                "SENT_ADD_COMMIT",
                "RCVD_ADD_REVOCATION",
                "RCVD_ADD_ACK_COMMIT",
                "SENT_ADD_ACK_REVOCATION",
                "RCVD_REMOVE_HTLC",
                "RCVD_REMOVE_COMMIT",
                "SENT_REMOVE_REVOCATION",
                "SENT_REMOVE_ACK_COMMIT",
                "RCVD_REMOVE_ACK_REVOCATION",
                "RCVD_ADD_HTLC",
                "RCVD_ADD_COMMIT",
                "SENT_ADD_REVOCATION",
                "SENT_ADD_ACK_COMMIT",
                "RCVD_ADD_ACK_REVOCATION",
                "SENT_REMOVE_HTLC",
                "SENT_REMOVE_COMMIT",
                "RCVD_REMOVE_REVOCATION",
                "RCVD_REMOVE_ACK_COMMIT",
                "SENT_REMOVE_ACK_REVOCATION"
              ],
              "description": [
                "The first 10 states are for `in`, the next 10 are for `out`."
              ]
            }
          }
        }
      }
    }
  },
  "author": [
    "Rusty Russell <<rusty@rustcorp.com.au>> is mainly responsible."
  ],
  "see_also": [
    "lightning-listforwards(7)"
  ],
  "resources": [
    "Main web site: <https://github.com/ElementsProject/lightning>"
  ],
  "examples": [
    {
      "request": {
        "id": "example:listhtlcs#1",
        "method": "listhtlcs",
        "params": [
          "110x1x0"
        ]
      },
      "response": {
        "htlcs": [
          {
            "created_index": 1,
            "updated_index": 9,
            "short_channel_id": "110x1x0",
            "id": 0,
            "expiry": 127,
            "direction": "out",
            "amount_msat": 500000000,
            "payment_hash": "342cbb1cb564e8f32eb64fe8c254abf5ec5f6b87a0f8de7909caf8e658f3bd2a",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 2,
            "updated_index": 18,
            "short_channel_id": "110x1x0",
            "id": 1,
            "expiry": 137,
            "direction": "out",
            "amount_msat": 10001,
            "payment_hash": "9562ee18e942b0eb2e36050c108efcb34cb07e5cdbe28d08d26bb71af1556c2f",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 3,
            "updated_index": 27,
            "short_channel_id": "110x1x0",
            "id": 2,
            "expiry": 150,
            "direction": "out",
            "amount_msat": 10001,
            "payment_hash": "097dcfa3b0bc58d499908855dae7d442854a02d4f2ffcc625f9385ed74f3256e",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 4,
            "updated_index": 36,
            "short_channel_id": "110x1x0",
            "id": 3,
            "expiry": 156,
            "direction": "out",
            "amount_msat": 10000202,
            "payment_hash": "9bf787fe700121009e2ecdca290632c8bf2da853527c700aa5746173981ae584",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 5,
            "updated_index": 44,
            "short_channel_id": "110x1x0",
            "id": 4,
            "expiry": 153,
            "direction": "out",
            "amount_msat": 10001,
            "payment_hash": "da6c0b6d30ac35f62762bc7114d64d323dc79fb858061902263eb72df6310caf",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 6,
            "updated_index": 53,
            "short_channel_id": "110x1x0",
            "id": 5,
            "expiry": 150,
            "direction": "out",
            "amount_msat": 10001,
            "payment_hash": "da6c0b6d30ac35f62762bc7114d64d323dc79fb858061902263eb72df6310caf",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 7,
            "updated_index": 62,
            "short_channel_id": "110x1x0",
            "id": 6,
            "expiry": 133,
            "direction": "out",
            "amount_msat": 50001,
            "payment_hash": "ab3a5a971aa3b21494f7ce646f077232c10c9917c33375935c1aebfa571fa1a1",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 8,
            "updated_index": 71,
            "short_channel_id": "110x1x0",
            "id": 7,
            "expiry": 139,
            "direction": "out",
            "amount_msat": 10002,
            "payment_hash": "1bb513fb2fbde40592243877d9f404ba3668275e2eeacd9c7264f34f04d37fd1",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 9,
            "updated_index": 79,
            "short_channel_id": "110x1x0",
            "id": 8,
            "expiry": 143,
            "direction": "out",
            "amount_msat": 1002,
            "payment_hash": "47c148c1746366e4c2c7496621c22002bc2711b4d9c52cbb9c7b1fdca59c8579",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 10,
            "updated_index": 87,
            "short_channel_id": "110x1x0",
            "id": 9,
            "expiry": 138,
            "direction": "out",
            "amount_msat": 10001,
            "payment_hash": "53a72d006c295bac2f2f81e6b82dd67193555a1859f7c90f84678b57ce6d10e2",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 11,
            "updated_index": 96,
            "short_channel_id": "110x1x0",
            "id": 0,
            "expiry": 137,
            "direction": "in",
            "amount_msat": 1000000,
            "payment_hash": "cedc7bf0a9109bd3cd86c5a0c90faa812b8a0ca3d65671c8b4001aae2647349f",
            "state": "SENT_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 12,
            "updated_index": 104,
            "short_channel_id": "110x1x0",
            "id": 10,
            "expiry": 145,
            "direction": "out",
            "amount_msat": 1000,
            "payment_hash": "ff498c3300881ea7a3c04193e43f123444c644662008108c23229da3511bedd1",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 13,
            "updated_index": 113,
            "short_channel_id": "110x1x0",
            "id": 11,
            "expiry": 269,
            "direction": "out",
            "amount_msat": 400000,
            "payment_hash": "e0b5658ef8e23cab6546ea5f7794a8c760483abf3613b34f401df4128944afae",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 14,
            "updated_index": 122,
            "short_channel_id": "110x1x0",
            "id": 12,
            "expiry": 137,
            "direction": "out",
            "amount_msat": 2000,
            "payment_hash": "2a25861f15614825bdfd154d422342f159446f0d54dc24e8385d31520023f8cb",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 15,
            "updated_index": 131,
            "short_channel_id": "110x1x0",
            "id": 13,
            "expiry": 137,
            "direction": "out",
            "amount_msat": 3000,
            "payment_hash": "36a32c9d7ee7baf5c15d1b9b27d085dce9c697fb427d0ce68342acce00e1586f",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 16,
            "updated_index": 140,
            "short_channel_id": "110x1x0",
            "id": 14,
            "expiry": 137,
            "direction": "out",
            "amount_msat": 5000,
            "payment_hash": "8e3ea1fb26e3e5e8627064e68e424713e3393752457ffe19a565fea54f6307d6",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 17,
            "updated_index": 149,
            "short_channel_id": "110x1x0",
            "id": 15,
            "expiry": 137,
            "direction": "out",
            "amount_msat": 4000,
            "payment_hash": "09963074ab0fc38044f890c763c658e7ea4f8b31ccbcfc6a0191163f5cdc4360",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 18,
            "updated_index": 158,
            "short_channel_id": "110x1x0",
            "id": 16,
            "expiry": 137,
            "direction": "out",
            "amount_msat": 1000,
            "payment_hash": "9a33e433faddc3371f6a56a34146c82629d567520ddaf28244bd9f196288af71",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 19,
            "updated_index": 165,
            "short_channel_id": "110x1x0",
            "id": 17,
            "expiry": 182,
            "direction": "out",
            "amount_msat": 4000082,
            "payment_hash": "2b924194d169a96d9cc35b66ae912507e18ace9ef679fcb5324636ff73be410a",
            "state": "SENT_ADD_ACK_REVOCATION"
          },
          {
            "created_index": 20,
            "updated_index": 170,
            "short_channel_id": "110x1x0",
            "id": 18,
            "expiry": 166,
            "direction": "out",
            "amount_msat": 1000000,
            "payment_hash": "2b924194d169a96d9cc35b66ae912507e18ace9ef679fcb5324636ff73be410a",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 21,
            "updated_index": 179,
            "short_channel_id": "110x1x0",
            "id": 19,
            "expiry": 172,
            "direction": "out",
            "amount_msat": 50000501,
            "payment_hash": "1d3a502d4b52d3c22af20f93605cadec2194da2e077b9fbbd15fa379c6bfbbdd",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 22,
            "updated_index": 188,
            "short_channel_id": "110x1x0",
            "id": 20,
            "expiry": 172,
            "direction": "out",
            "amount_msat": 50000501,
            "payment_hash": "39a88ddc69c973a791043a877a415eda840888849a5d7175c9666104513f9235",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          },
          {
            "created_index": 23,
            "updated_index": 196,
            "short_channel_id": "110x1x0",
            "id": 21,
            "expiry": 172,
            "direction": "out",
            "amount_msat": 50000501,
            "payment_hash": "287476fe90c160d09bf95156469dc3cfc82e366c4676c9b774f26051bd465a96",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          }
        ]
      }
    },
    {
      "request": {
        "id": "example:listhtlcs#2",
        "method": "listhtlcs",
        "params": {
          "index": "created",
          "start": 4,
          "limit": 1
        }
      },
      "response": {
        "htlcs": [
          {
            "created_index": 4,
            "updated_index": 36,
            "short_channel_id": "110x1x0",
            "id": 3,
            "expiry": 156,
            "direction": "out",
            "amount_msat": 10000202,
            "payment_hash": "9bf787fe700121009e2ecdca290632c8bf2da853527c700aa5746173981ae584",
            "state": "RCVD_REMOVE_ACK_REVOCATION"
          }
        ]
      }
    }
  ]
}
